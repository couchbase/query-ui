<qw-workbench-subnav></qw-workbench-subnav>

<div *ngIf="!validated.valid()">
  No query service found. If the cluster recently started, try reloading the page.
</div>


<!-- Function Libraries Table  ************************************  -->

<div *ngIf="validated.valid()">
<h4 class="margin-top-half">Javascript Function Libraries</h4>
<div *ngIf="!externalPermitted()" class="margin-bottom-1">
  <smalL class="margin-left-1">Insufficent permissions to view/edit external function libraries.</smalL>
</div>
<div *ngIf="externalPermitted()" class="qm-table-active cbui-table margin-bottom-2">
  <!-- table wrapper -->
  <div class="cbui-table-header flex-grow-half padding-left">
    <!-- table header row, no <section> wrapper -->
    <span class="cbui-table-cell">name</span>
    <span class="cbui-table-cell flex-grow-2">definition</span>
    <span class="cbui-table-cell flex-grow-half"></span>
  </div>

  <section
     *ngFor="let lib of qqs.udfLibs">
    <div class="cbui-tablerow padding-left">
      <span class="cbui-table-cell">
        {{lib.name}}
      </span>
      <span class="cbui-table-cell flex-grow-2"
            ngbTooltip="{{lib.content}}"
            placement="auto"
            tooltip-append-to-body="true"
            tooltip-class="break-word">
      {{lib.content}}
      </span>
      <span class="cbui-table-cell text-right flex-grow-half">
        <a class="margin-right-1" (click)="editLibrary(lib)">edit</a>
        <a (click)="dropLibrary(lib)">drop</a>
       </span>
    </div>
  </section>
  <div class="cbui-tablerow padding-left">
    <a (click)="createLibrary()">+ add function library</a>
  </div>
</div>

<!-- Functions Table  ************************************  -->
<h4>User-Defined Functions</h4>
<div *ngIf="!viewFunctionsPermitted()">
  <small class="margin-left-1">Insufficient permissions to view user-defined functions.</small>
</div>
<div *ngIf="viewFunctionsPermitted()" class="padding-bottom-6">
  <div class="qm-table-active cbui-table">
    <!-- table wrapper -->
    <div class="cbui-table-header padding-left">
      <!-- table header row, no <section> wrapper -->
      <span class="cbui-table-cell" (click)="update_function_sort('scope')">namespace
          <span *ngIf="show_up_caret_function('scope')" class="icon fa-caret-up"></span>
          <span *ngIf="show_down_caret_function('scope')" class="icon fa-caret-down"></span>
      </span>
      <span class="cbui-table-cell flex-grow-half" (click)="update_function_sort('name')">function name
          <span *ngIf="show_up_caret_function('name')" class="icon fa-caret-up"></span>
          <span *ngIf="show_down_caret_function('name')" class="icon fa-caret-down"></span>
      </span>
      <span class="cbui-table-cell flex-grow-half" (click)="update_function_sort('language')">language
          <span *ngIf="show_up_caret_function('language')" class="icon fa-caret-up"></span>
          <span *ngIf="show_down_caret_function('language')" class="icon fa-caret-down"></span>
      </span>
      <span class="cbui-table-cell flex-grow-half">parameters</span>
      <span class="cbui-table-cell flex-grow-2">definition / expression</span>
      <span class="cbui-table-cell flex-grow-half"></span>
    </div>

    <section *ngFor="let function of get_sorted_udfs()">
      <div class="cbui-tablerow padding-left">
        <span
           class="cbui-table-cell"
           ngbTooltip="{{getFunctionScope(function)}}"
           placement="auto"
           tooltip-append-to-body="true"
           tooltip-class="break-word">
          <span>{{getFunctionScope(function)}}</span>
        </span>
        <span class="cbui-table-cell flex-grow-half has-hover"
              ngbTooltip="{{function.identity.name}}">
          {{function.identity.name}}
        </span>
        <span class="cbui-table-cell flex-grow-half has-hover"
              ngbTooltip="{{getFunctionLanguage(function)}}">
          {{getFunctionLanguage(function)}}
        </span>
        <span class="cbui-table-cell flex-grow-half has-hover"
              ngbTooltip="{{getFunctionParams(function)}}">
          {{getFunctionParams(function)}}
        </span>
        <span class="cbui-table-cell flex-grow-2 has-hover"
              ngbTooltip="{{function.definition.object || function.definition.expression}}">
          {{function.definition.object || function.definition.expression}}
        </span>
        <span class="cbui-table-cell text-right flex-grow-half">
          <a *ngIf="manageFunctionsPermitted()" class="margin-right-1" (click)="editFunction(function)">edit</a>
          <a *ngIf="manageFunctionsPermitted()" (click)="dropFunction(function)">drop</a>
          <a *ngIf="!manageFunctionsPermitted()" class="margin-right-1" (click)="editFunction(function)">view</a>
        </span>
      </div>
    </section>
      <div *ngIf="manageFunctionsPermitted()" class="cbui-tablerow padding-left">
        <a (click)="createFunction()">+ add function</a>
      </div>
  </div>

</div>
</div>